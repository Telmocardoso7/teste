function ControlPanels(){LoadFormHome()}function ShowStart(){$("#dvStart").slideDown("slow");$("#pnlIBAN").slideUp("slow")}function ShowAccountList(){$.LoadingSpin("show","body",$("#loadingSpin-text").val());$("#pnlIBAN").slideUp("slow");$("#pnlAccountList").slideDown("slow");var n=$("#hdToken").val(),t=$("#txtBban").val();$("#btnClose").attr("disabled","true");$.post("/TPP/Manager/CreateConsent",{token:n,strBban:t},function(t){var i,u,f;if(i="Service Call: /aisp/v1/consents&nbsp&nbsp&nbsp---"+new Date($.now()).toString(),Log(i),consentID=t,consentID.length<30)$.LoadingSpin("hide","body"),window.location.reload();else{$.LoadingSpin("show","body",$("#loadingSpin-text").val());$("#hdConsentID").val(consentID);var e=!1,o=consentID,r=o.split("|");consentID=r[0];u=r[1];window.open(u,"_blank");f=setInterval(function(){$.post("/TPP/Manager/GetConsentStatus",{consentID:consentID,token:n},function(t){var r="Service Call: /aisp/v1/consents/"+consentID+"/status&nbsp&nbsp&nbsp---"+new Date($.now()).toString(),i;Log(r);i=t;i.consentStatus==="valid"?(e=!0,clearInterval(f),$.post("/TPP/Manager/GetAcountIdList",{consentID:consentID,token:n},function(t){var r,i,u;for(r="Service Call: /aisp/v1/accounts&nbsp&nbsp&nbsp---"+new Date($.now()).toString(),Log(r),i=0;i<t.accounts.length;i++)u=$('<input id="hdAccountList_'+i+'" type="hidden" value="'+t.accounts[i].resourceId+'" data-iban="'+t.accounts[i].iban+'" data-balance-endpoint="'+t.accounts[i]._links.balances.href+'"  class="accountList" />'),$("#dvhidden").append(u);$(".accountList").each(function(){var t=$(this).val(),i=$(this).attr("data-iban"),r=$(this).attr("data-balance-endpoint");$.ajax({type:"POST",url:"/TPP/Manager/GetAccountBalance",data:{consentID:consentID,token:n,accountId:t,balanceEndpoint:r},dataType:"json",success:function(n){var f="Service Call: /aisp/v1/accounts/"+consentID+"/balances&nbsp&nbsp&nbsp---"+new Date($.now()).toString(),r,u,t;Log(f);r=$('<tr class="trline"><\/tr>');u="";n.account!==undefined&&n.account!==null&&n.account.bban!==undefined&&(u=n.account.bban);t=$("<td>"+u+"<\/td>");r.append(t);t=$("<td>"+i+"<\/td>");r.append(t);t=$("<td>"+n.balances[0].balanceAmount._Amount+n.balances[0].balanceAmount.currency+"<\/td>");r.append(t);$("#tbList").find("tbody").append(r)},error:function(n){Log(n.statusText)},"async":!1})});$.LoadingSpin("hide","body");$("#btnClose").removeAttr("disabled")},"json").fail(function(n){$.LoadingSpin("hide","body");Log(n.statusText)})):i.consentStatus==="rejected"&&($.LoadingSpin("hide","body"),window.location.reload())},"json").fail(function(n){$.LoadingSpin("hide","body");Log(n.statusText)})},5e3)}}).fail(function(n){$.LoadingSpin("hide","body");Log(n.statusText)})}function CloseAccountList(){$("#pnlAccountList").slideUp("slow");$("#pnlIBAN").slideDown("slow");$(".trline").remove("tr");$(".accountList").remove("input")}function ShowPayment(){var n,t;$.LoadingSpin("show","body",$("#loadingSpin-text").val());n={};n.clientID=$("#txtClientId").val();n.secretID=$("#txtSecretId").val();n.scope=$("#txtScope").val();t="";$.post("/TPP/Manager/GetHomeData",{objHomeModel:n},function(i){var r="Service Call: /connect/token&nbsp&nbsp&nbsp---"+new Date($.now()).toString();Log(r);t=i;t===""?alert("Invalid Token!"):($("#dvStart").slideUp("slow"),$("#dvPayment").show(),setCookie("tppEndPoint",n.endPoint,7),setCookie("tppToken",t,7));$("#hdToken").val(t)},"json").fail(function(n){Log(n.statusText)}).always(function(){$.LoadingSpin("hide","body")})}function StartPayment(){var n,t;$.LoadingSpin("show","body",$("#loadingSpin-text").val());n={};n.paymentAccount=$("#txtPaymentAccount").val();n.myAccount=$("#txtMyAccount").val();n.value=$("#txtValue").val();n.currency=$("#ddlCurrency").val();n.token=$("#hdToken").val();t=$("#hdToken").val();$.post("/TPP/Manager/StartPayment",{objPayment:n},function(n){var i="Service Call: /pisp/v1/payments/payments/sepa-credit-transfers&nbsp&nbsp&nbsp---"+new Date($.now()).toString(),f;Log(i);var e=n,r=e.split("|"),u=r[0],o=r[1],s=r[2];$("#txtPaymentId").val(u);$("#txtAuth").val(o);window.open(s,"_blank");f=setInterval(function(){$.LoadingSpin("show","body",$("#loadingSpin-text").val());$.post("/TPP/Manager/GetPaymentStatus",{PaymentID:u,token:t},function(n){i="Service Call: /common/v1/payments/GetPaymentForCore/"+u+"&nbsp&nbsp&nbsp---"+new Date($.now()).toString();Log(i);var t=n;(t.paymentStatus===2||t.paymentStatus===9)&&($.LoadingSpin("hide","body"),MakePaymentTable(t),$("#dvPayment").slideUp("slow"),$("#pnlPaymentInformation").slideDown("slow"),clearInterval(f))},"json").fail(function(n){$.LoadingSpin("hide","body");Log(n.statusText)})},5e3)},"json").fail(function(n){$.LoadingSpin("hide","body");Log(n.statusText)})}function MakePaymentTable(n){var u=$("#tbPaymentDetails"),t="",i,r,f;$(".trline").remove("tr");i=$('<td class="title">Payment ID<\/td>');r=$("<td>"+n.paymentId+"<\/td>");t=$('<tr class="trline"><\/tr>');t.append(i);t.append(r);u.append(t);i=$('<td class="title">Client ID<\/td>');r=$("<td>"+n.clientId+"<\/td>");t=$('<tr class="trline"><\/tr>');t.append(i);t.append(r);u.append(t);i=$('<td class="title">Creation date<\/td>');r=$("<td>"+n.createDate+"<\/td>");t=$('<tr class="trline"><\/tr>');t.append(i);t.append(r);u.append(t);f=n.paymentStatus;f=f===2?"SUCCESS":"FAILED";i=$('<td class="title">Payment status<\/td>');r=$("<td>"+f+"<\/td>");t=$('<tr class="trline"><\/tr>');t.append(i);t.append(r);u.append(t);i=$('<td class="title">Source account number<\/td>');r=$("<td>"+n.debtorNumber+"<\/td>");t=$('<tr class="trline"><\/tr>');t.append(i);t.append(r);u.append(t);i=$('<td class="title">Beneficiary account number<\/td>');r=$("<td>"+n.creditorAccount+"<\/td>");t=$('<tr class="trline"><\/tr>');t.append(i);t.append(r);u.append(t);i=$('<td class="title">Beneficiary account name<\/td>');r=$("<td>"+n.creditorName+"<\/td>");t=$('<tr class="trline"><\/tr>');t.append(i);t.append(r);u.append(t);i=$('<td class="title">Amount<\/td>');r=$("<td>"+n.amount+"<\/td>");t=$('<tr class="trline"><\/tr>');t.append(i);t.append(r);u.append(t);i=$('<td class="title">Currency<\/td>');r=$("<td>"+n.currency+"<\/td>");t=$('<tr class="trline"><\/tr>');t.append(i);t.append(r);u.append(t);i=$('<td class="title">Process ID<\/td>');r=$("<td>"+n.processTransactionId+"<\/td>");t=$('<tr class="trline"><\/tr>');t.append(i);t.append(r);u.append(t)}function ClosePayment(){$("#dvPayment").slideUp("slow");$("#dvStart").slideDown("slow");$(".trline").remove("tr")}function LoadFormHome(){var n,t;$.LoadingSpin("show","body",$("#loadingSpin-text").val());n={};n.clientID=$("#txtClientId").val();n.secretID=$("#txtSecretId").val();n.scope=$("#txtScope").val();t="";$.post("/TPP/Manager/GetHomeData",{objHomeModel:n},function(n){var i="Service Call: /connect/token&nbsp&nbsp&nbsp---"+new Date($.now()).toString();Log(i);t=n;t===""?alert("Invalid Token!"):($("#dvStart").slideUp("slow"),$("#pnlIBAN").show());$("#hdToken").val(t)},"json").fail(function(n){Log(n.statusText)}).always(function(){$.LoadingSpin("hide","body")})}function Log(n){var t=$("<tr><\/tr>"),i=$("<td>"+n+"<\/td>");t.append(i);$("#tbLog").append(t)}function ClosePaymentInformation(){$("#txtPaymentId").val("-");$("#txtAuth").val("-");$("#txtPaymentAccount").val("");$("#txtMyAccount").val("");$("#pnlPaymentInformation").slideUp("slow");$("#dvStart").slideDown("slow")}function setCookie(n,t,i){var u="",r;i&&(r=new Date,r.setTime(r.getTime()+i*864e5),u="; expires="+r.toUTCString());document.cookie=n+"="+(t||"")+u+"; path=/"}function getCookie(n){for(var t,r=n+"=",u=document.cookie.split(";"),i=0;i<u.length;i++){for(t=u[i];t.charAt(0)===" ";)t=t.substring(1,t.length);if(t.indexOf(r)===0)return t.substring(r.length,t.length)}return null}function eraseCookie(n){document.cookie=n+"=; Max-Age=-99999999;"}$(document).ready(function(){$("#tbLog").find("td").length<=0&&$(".s-traceLog").hide();$("#txtBban").keyup(function(){$(this).val()!==undefined&&$(this).val()!==""?$(".btnAddSpecificAccount").prop("disabled",!1):$(".btnAddSpecificAccount").prop("disabled",!0)})});$("input").click(function(){$(".s-traceLog").show()});