function injectUnblu(){(function(){if(!window.unblu){var n=$("[id$=hdnUnbluApykey]").val(),t=$("[id$=hdnUnbluServer]").val();unblu={APIKEY:n,SERVER:t},function(){function i(n){var t=null;return t&&(n=t(n)),n}var t,n;unblu.c=[];unblu.registerApiConsumer=function(n,t,i){unblu.c.push({a:i,c:n,e:t})};unblu.setLocale=function(n){unblu.l=n};window["x-unblu-tmp-window-name"]||(window["x-unblu-tmp-window-name"]=window.name);t=document.getElementsByTagName("script")[0];t&&(n=document.createElement("script"),n.setAttribute("src",i(unblu.SERVER+"/unblu/starter.js")),n.setAttribute("type","text/javascript"),n.setAttribute("defer","defer"),t.parentNode.appendChild(n))}()}})()}function setCoBrowsingSession(n,t){setTimeout(function(){n?($(".CoBrowsingSessionActive").show(),$(".ChatSession").hide(),$(".CoBrowsingSessionInactive").hide()):($(".CoBrowsingSessionInactive").show(),$(".CoBrowsingSessionActive").hide(),$(".ChatSession").show());$("[id$=CoBrowsingBarOpened]").css("transform","translate(-50px,0)");$("[id$=CoBrowsingBarClosed]").css("transform","translate(-50px,0)");$("[id$=CoBrowsingBarClosed]").show()},t*1e3)}function coBrowsingBarToggle(){$("[id$=CoBrowsingBarOpened]").toggle();$("[id$=CoBrowsingBarClosed]").toggle()}function checkCoBrowsingSession(){unblu.api||unblu.apiConsumerRegistered?checkCoBrowsingSessionHelper():(unblu.apiConsumerRegistered=!0,unblu.registerApiConsumer(function(n){unblu.api=n;checkCoBrowsingSessionHelper()},null,["core.visitor.session"]))}function checkCoBrowsingSessionHelper(){if(unblu.api){var n=unblu.api.core.visitor.session.Session.getInstance();n.isSessionActive({onSuccess:function(t){t?(setCoBrowsingSession(!0,0),addCoBrowsingSessionListeners(n)):(delete_cookie("unblu"),setCoBrowsingSession(!1,4))},onFailure:function(n){alert("Session status ERROR\nDescription: "+n.message)}})}}function startCoBrowsingSession(){if($("[id$=cb_ls_conditions]").prop("checked")){if(unblu.api||unblu.apiConsumerRegistered||(unblu.apiConsumerRegistered=!0,unblu.registerApiConsumer(function(n){unblu.api=n},null,["core.visitor.session"])),unblu.api){var t=$("[id$=i_pin]").val(),n=unblu.api.core.visitor.session.Session.getInstance();n.startSessionWithName(t,"CLIENTE",{onSuccess:function(t){writeCookie("unblu",t.sessionId,1);$("#modal_startCoBrowsing").modal("toggle");setCoBrowsingSession(!0,0);addCoBrowsingSessionListeners(n);$("[id$=i_pin]").val("")},onFailure:function(n){alert("Start Session ERROR\nDescription: "+n.message)}})}}else $("[id$=ls_error]").show()}function startChatSession(){window.unblu||injectUnblu();unblu.api||unblu.apiConsumerRegistered?checkChatSessionHelper():(unblu.apiConsumerRegistered=!0,unblu.registerApiConsumer(function(n){unblu.api=n;checkChatSessionHelper()},null,["core.visitor.session"]))}function checkChatSessionHelper(){if(unblu.api){var n=unblu.api.core.visitor.session.Session.getInstance();n.startChatSession("CLIENT",{onSuccess:function(t){writeCookie("unblu",t.sessionId,1);addCoBrowsingSessionListeners(n)},onFailure:function(n){alert("Start Session ERROR\nDescription: "+n.message)}})}}function closeCoBrowsingSession(){unblu.api||unblu.apiConsumerRegistered||(unblu.apiConsumerRegistered=!0,unblu.registerApiConsumer(function(n){unblu.api=n;checkCoBrowsingState()},null,["core.visitor.session"]));checkCoBrowsingState()}function checkCoBrowsingState(){unblu.api&&unblu.api.core.visitor.session.Session.getInstance().isSessionActive({onSuccess:function(n){n?closeCoBrowsingSessionHelper():(delete_cookie("unblu"),setCoBrowsingSession(!1,0))},onFailure:function(n){alert("Get Session state ERROR\nDescription: "+n.message)}})}function closeCoBrowsingSessionHelper(){unblu.api&&unblu.api.core.visitor.session.Session.getInstance().terminateSession({onSuccess:function(){delete_cookie("unblu");setCoBrowsingSession(!1,0)},onFailure:function(n){alert("Terminate Session ERROR\nDescription: "+n.message)}})}function addCoBrowsingSessionListeners(n){n.addSessionAbortedListener(function(n){abortedSessionHandler(n)});n.addSessionTerminatedListener(function(n){terminatedSessionHandler(n)});n.addSessionEndedListener(function(n){endedSessionHandler(n)})}function abortedSessionHandler(n){n.data.terminationCause.code===1&&$("[id$=ls_closeAuthor]").text("Gestor")}function terminatedSessionHandler(){$("[id$=ls_closeAuthor]").text("Cliente")}function endedSessionHandler(){delete_cookie("unblu");setCoBrowsingSession(!1,0)}function lsErrorHandling(){$("[id$=cb_ls_conditions]").prop("checked")&&$("[id$=ls_error]").hide()}function writeCookie(n,t,i){var r,u;i?(r=new Date,r.setTime(r.getTime()+i*36e5),u="; expires="+r.toGMTString()):u="";document.cookie=n+"="+t+u+"; path=/"}function readCookie(n){for(var t,u=n+"=",r=document.cookie.split(";"),i=0;i<r.length;i++){for(t=r[i];t.charAt(0)===" ";)t=t.substring(1,t.length);if(t.indexOf(u)===0)return t.substring(u.length,t.length)}return""}function delete_cookie(n){document.cookie=n+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function checkName(){unblu.api||unblu.apiConsumerRegistered||(unblu.apiConsumerRegistered=!0,unblu.registerApiConsumer(function(n){unblu.api=n;checkCoBrowsingState()},["core.visitor.session"]));checkNameHelper()}function checkNameHelper(){if(unblu.api){var n=unblu.api.core.visitor.session.Session.getInstance();alert(n.EActor.values("OTHER_PARTICIPANT"))}}