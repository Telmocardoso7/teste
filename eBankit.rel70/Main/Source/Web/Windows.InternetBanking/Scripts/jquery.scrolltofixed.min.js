(function(n){n.isScrollToFixed=function(t){return!!n(t).data("ScrollToFixed")};n.ScrollToFixed=function(t,i){function ot(){r.trigger("preUnfixed.ScrollToFixed");o();r.trigger("unfixed.ScrollToFixed");l=-1;p=r.offset().top;h=r.offset().left;u.options.offsets&&(h+=r.offset().left-r.position().left);it==-1&&(it=h);f=r.css("position");y=!0;u.options.bottom!=-1&&(r.trigger("preFixed.ScrollToFixed"),k(),r.trigger("fixed.ScrollToFixed"))}function rt(){var n=u.options.limit;return n?typeof n=="function"?n.apply(r):n:0}function a(){return f==="fixed"}function ut(){return f==="absolute"}function c(){return!(a()||ut())}function k(){a()||(e.css({display:r.css("display"),width:r.outerWidth(!0),height:r.outerHeight(!0),float:r.css("float")}),cssOptions={"z-index":u.options.zIndex,position:"fixed",top:u.options.bottom==-1?w():"",bottom:u.options.bottom==-1?"":u.options.bottom,"margin-left":"0px"},u.options.dontSetWidth||(cssOptions.width=r.width()),r.css(cssOptions),r.addClass(u.options.baseClassName),u.options.className&&r.addClass(u.options.className),f="fixed")}function ft(){var n=rt(),t=h;u.options.removeOffsets&&(t="",n=n-p);cssOptions={position:"absolute",top:n,left:t,"margin-left":"0px",bottom:""};u.options.dontSetWidth||(cssOptions.width=r.width());r.css(cssOptions);f="absolute"}function o(){c()||(l=-1,e.css("display","none"),r.css({"z-index":tt,width:"",position:b,left:"",top:nt,"margin-left":""}),r.removeClass("scroll-to-fixed-fixed"),u.options.className&&r.removeClass(u.options.className),f=null)}function d(n){n!=l&&(r.css("left",h-n),l=n)}function w(){var n=u.options.marginTop;return n?typeof n=="function"?n.apply(r):n:0}function v(){var t;if(n.isScrollToFixed(r)){t=y;y?c()&&(p=r.offset().top,h=r.offset().left):ot();var f=n(window).scrollLeft(),e=n(window).scrollTop(),i=rt();u.options.minWidth&&n(window).width()<u.options.minWidth?c()&&t||(s(),r.trigger("preUnfixed.ScrollToFixed"),o(),r.trigger("unfixed.ScrollToFixed")):u.options.maxWidth&&n(window).width()>u.options.maxWidth?c()&&t||(s(),r.trigger("preUnfixed.ScrollToFixed"),o(),r.trigger("unfixed.ScrollToFixed")):u.options.bottom==-1?i>0&&e>=i-w()?ut()&&t||(s(),r.trigger("preAbsolute.ScrollToFixed"),ft(),r.trigger("unfixed.ScrollToFixed")):e>=p-w()?(a()&&t||(s(),r.trigger("preFixed.ScrollToFixed"),k(),l=-1,r.trigger("fixed.ScrollToFixed")),d(f)):c()&&t||(s(),r.trigger("preUnfixed.ScrollToFixed"),o(),r.trigger("unfixed.ScrollToFixed")):i>0?e+n(window).height()-r.outerHeight(!0)>=i-(w()||-st())?a()&&(s(),r.trigger("preUnfixed.ScrollToFixed"),b==="absolute"?ft():o(),r.trigger("unfixed.ScrollToFixed")):(a()||(s(),r.trigger("preFixed.ScrollToFixed"),k()),d(f),r.trigger("fixed.ScrollToFixed")):d(f)}}function st(){return u.options.bottom?u.options.bottom:0}function s(){var n=r.css("position");n=="absolute"?r.trigger("postAbsolute.ScrollToFixed"):n=="fixed"?r.trigger("postFixed.ScrollToFixed"):r.trigger("postUnfixed.ScrollToFixed")}var u=this;u.$el=n(t);u.el=t;u.$el.data("ScrollToFixed",u);var y=!1,r=u.$el,f,b,nt,tt,p=0,h=0,it=-1,l=-1,e=null;var g=function(){r.is(":visible")&&(y=!1,v())},et=function(){!window.requestAnimationFrame?v():requestAnimationFrame(v)},ct=function(){var n=document.body,t,i,r,u,f;return document.createElement&&n&&n.appendChild&&n.removeChild?(t=document.createElement("div"),!t.getBoundingClientRect)?null:(t.innerHTML="x",t.style.cssText="position:fixed;top:100px;",n.appendChild(t),i=n.style.height,r=n.scrollTop,n.style.height="3000px",n.scrollTop=500,u=t.getBoundingClientRect().top,n.style.height=i,f=u===100,n.removeChild(t),n.scrollTop=r,f):null},ht=function(n){n=n||window.event;n.preventDefault&&n.preventDefault();n.returnValue=!1};u.init=function(){u.options=n.extend({},n.ScrollToFixed.defaultOptions,i);tt=r.css("z-index");u.$el.css("z-index",u.options.zIndex);e=n("<div />");f=r.css("position");b=r.css("position");nt=r.css("top");c()&&u.$el.after(e);n(window).bind("resize.ScrollToFixed",g);n(window).bind("scroll.ScrollToFixed",et);"ontouchmove"in window&&n(window).bind("touchmove.ScrollToFixed",v);u.options.preFixed&&r.bind("preFixed.ScrollToFixed",u.options.preFixed);u.options.postFixed&&r.bind("postFixed.ScrollToFixed",u.options.postFixed);u.options.preUnfixed&&r.bind("preUnfixed.ScrollToFixed",u.options.preUnfixed);u.options.postUnfixed&&r.bind("postUnfixed.ScrollToFixed",u.options.postUnfixed);u.options.preAbsolute&&r.bind("preAbsolute.ScrollToFixed",u.options.preAbsolute);u.options.postAbsolute&&r.bind("postAbsolute.ScrollToFixed",u.options.postAbsolute);u.options.fixed&&r.bind("fixed.ScrollToFixed",u.options.fixed);u.options.unfixed&&r.bind("unfixed.ScrollToFixed",u.options.unfixed);u.options.spacerClass&&e.addClass(u.options.spacerClass);r.bind("resize.ScrollToFixed",function(){e.height(r.height())});r.bind("scroll.ScrollToFixed",function(){r.trigger("preUnfixed.ScrollToFixed");o();r.trigger("unfixed.ScrollToFixed");v()});r.bind("detach.ScrollToFixed",function(t){ht(t);r.trigger("preUnfixed.ScrollToFixed");o();r.trigger("unfixed.ScrollToFixed");n(window).unbind("resize.ScrollToFixed",g);n(window).unbind("scroll.ScrollToFixed",et);r.unbind(".ScrollToFixed");e.remove();u.$el.removeData("ScrollToFixed")});g()};u.init()};n.ScrollToFixed.defaultOptions={marginTop:0,limit:0,bottom:-1,zIndex:1e3,baseClassName:"scroll-to-fixed-fixed"};n.fn.scrollToFixed=function(t){return this.each(function(){new n.ScrollToFixed(this,t)})}})(jQuery);