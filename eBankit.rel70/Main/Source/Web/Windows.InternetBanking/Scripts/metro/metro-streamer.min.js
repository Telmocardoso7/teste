(function(n){n.widget("metro.streamer",{version:"1.0.0",options:{scrollBar:!1,meter:{start:9,stop:19,interval:20},slideToGroup:1,slideToTime:"10:20",slideSleep:1e3,slideSpeed:1e3,onClick:function(){},onLongClick:function(){}},_create:function(){var h=this,t=this.element,i=this.options,c=t.find(".stream"),r=t.find(".event"),s=t.find(".events"),y=t.find(".events-area"),l=t.find(".event-group"),p=t.find(".event-stream"),o;t.data("scrollBar")!=undefined&&(i.scrollBar=t.data("scrollBar"));t.data("meterStart")!=undefined&&(i.meter.start=parseInt(t.data("meterStart")));t.data("meterStop")!=undefined&&(i.meter.stop=parseInt(t.data("meterStop")));t.data("meterInterval")!=undefined&&(i.meter.interval=t.data("meterInterval"));t.data("slideToGroup")!=undefined&&(i.slideToGroup=parseInt(t.data("slideToGroup")));t.data("slideSleep")!=undefined&&(i.slideSleep=parseInt(t.data("slideSleep")));t.data("slideSpeed")!=undefined&&(i.slideSpeed=parseInt(t.data("slideSpeed")));t.data("streamSelect",-1);for(var a=n("<ul/>").addClass("meter"),f,e,w=i.meter.start,b=i.meter.stop,k=i.meter.interval,v=[],u=w;u<b;u++)for(f=0;f<60;f+=k)e=(u<10?"0"+u:u)+":"+(f<10?"0"+f:f),n("<li/>").addClass("js-interval-"+e.replace(":","-")).html("<em>"+e+"<\/em>").appendTo(a),v.push(e);t.data("intervals",v);a.insertBefore(t.find(".events-grid"));t.find(".event-stream").each(function(t,i){var r=0,u=n(i).find(".event");u.each(function(t,i){r+=n(i).outerWidth()});n(i).css({width:r+(u.length-1)*2+1});n(i).find(".time").css("background-color",n(c[t]).css("background-color"))});s.css({"overflow-x":i.scrollBar?"scroll":"hidden"});t.css({height:t.find(".streams").outerHeight()+(i.scrollBar?20:0)});o=0;l.each(function(t,i){o+=n(i).outerWidth()});o+=(l.length-1)*2+10;y.css("width",o);r.each(function(n,t){addTouchEvents(t)});r.mousedown(function(t){t.altKey&&n(this).toggleClass("selected")});t.mousewheel(function(n,t){var i=t*50;return s.scrollLeft(s.scrollLeft()-i),!1});c.each(function(i,u){n(u).mousedown(function(){t.data("streamSelect")==i?(r.removeClass("event-disable"),t.data("streamSelect",-1)):(t.data("streamSelect",i),r.addClass("event-disable"),n(p[i]).find(".event").removeClass("event-disable"))})});r.on("click",function(t){t.preventDefault();i.onClick(n(this))});r.on("longclick",function(t){n(this).toggleClass("selected");t.preventDefault();i.onLongClick(n(this))});t.find(".js-go-previous-time").on("click",function(){var n=t.data("intervals").indexOf(t.data("current-time")),r;n!=0&&(n--,r=t.data("intervals")[n],h.slideToTime(r,0,i.slideSpeed))});t.find(".js-go-next-time").on("click",function(){var n=t.data("intervals").indexOf(t.data("current-time")),r;n!=t.data("intervals").length-1&&(n++,r=t.data("intervals")[n],h.slideToTime(r,0,i.slideSpeed))});t.find(".js-show-all-streams").on("click",function(n){t.find(".event").removeClass("event-disable");t.data("streamSelect",-1);n.preventDefault()});t.find(".js-schedule-mode").on("click",function(i){n(this).toggleClass("inverse");t.data("schedule-mode",n(this).hasClass("inverse"));i.preventDefault()});i.slideToTime?this.slideToTime(i.slideToTime,i.slideSleep,i.slideSpeed):this.slideToGroup(i.slideToGroup,i.slideSleep,i.slideSpeed)},slideToTime:function(n,t,i){var u=this,r=this.element,f=r.find(".meter li.js-interval-"+n.replace(":","-"))[0],e=r.find(".streams").outerWidth()+2;setTimeout(function(){r.find(".events").animate({scrollLeft:"+="+(f.offsetLeft-e)},i,function(){u._afterSlide()})},t);r.data("current-time",n)},slideToGroup:function(n,t,i){var u=this,r=this.element,f=r.find(".event-group"),e=r.find(".streams").outerWidth()+2;setTimeout(function(){r.find(".events").animate({scrollLeft:"+="+(f[n-1].offsetLeft-e)},i,function(){u._afterSlide()})},t)},_afterSlide:function(){},_destroy:function(){},_setOption:function(n,t){this._super("_setOption",n,t)}})})(jQuery);