function GetSMSClick(n,t,i,r,u,f,e,o){var b=$("#divErrorSMS"),a,v,y,s,l,h;b.hide();a=$("#divErrorHardToken");a.hide();v=$("#divErrorPositions");v.hide();y=$("#divErrorPassword");y.hide();matrixWasSuccess=!1;var c=$("#"+f),p=$("#"+e),w=$("#"+o),it=$("#"+u);if(smsWasSuccess===!1)if(s=$("[id$=btnSendSMS]"),s.data("modal-display")==!0){l=$(".js-deliveryType-container").clone();h=l.find(".js-deliveryType-dropdown");h&&(h.removeAttr("for"),h.find("select").removeAttr("id"));var k=l.html(),d=s.data("modal-title"),g=s.data("modal-accept-btn"),nt=s.data("modal-cancel-btn"),tt={beforeShow:PrepareDeliveryTypeModal};itcore_ui.ShowTopPopupConfirm(k,d,"CloseDeliveryTypeModal();",g,nt,tt)}else RequestNewSMS();else $(".trs_buttons-action").show(),ToogleArrowLeftDownIcon(collapseSmsTokenIcon.id),c.is(":hidden")?(c.slideDown("fast"),p.is(":visible")&&(ToogleArrowLeftDownIcon(collapseMatrixCardIcon.id),p.slideUp("fast")),w.is(":visible")&&(ToogleArrowLeftDownIcon(collapseHardTokenIcon.id),w.slideUp("fast"))):c.slideUp("fast")}function RequestNewSMS(){var n,t;authentFormSMS.hide();n=$("[id$=hdnGetPositions]");n.val(2);eBankit.Presentation.BlockPageForAjaxRequest();t=$("[id$=btnSendSMS]");t.click()}function CloseDeliveryTypeModal(){var n=window.top.$(".topModalcontainer").find(".js-deliveryType-dropdown select"),t=$(".js-deliveryType-value");n&&t&&t.val(n.val());RequestNewSMS()}function PrepareDeliveryTypeModal(){var n=this.find(".modal");n&&n.addClass("modal-form")}function GetHardToken(n,t,i,r,u,f,e,o){var p=$("#divErrorSMS"),h,c,l,w,y;p.hide();h=$("#divErrorHardToken");h.hide();c=$("#divErrorPositions");c.hide();l=$("#divErrorPassword");l.hide();var s=$("#"+f),a=$("#"+e),v=$("#"+o),b=$("#"+u);matrixWasSuccess=!1;tokenWasSuccess===!1?(w=$("#"+n),authentFormHardToken.hide(),y=$("[id$=hdnGetPositions]"),y.val(3),eBankit.Presentation.BlockPageForAjaxRequest(),$("[id$=btnRequestToken]").click()):($(".trs_buttons-action").show(),ToogleArrowLeftDownIcon(collapseHardTokenIcon.id),s.is(":hidden")?(s.slideDown("fast"),a.is(":visible")&&(ToogleArrowLeftDownIcon(collapseSmsTokenIcon.id),a.slideUp("fast")),v.is(":visible")&&(ToogleArrowLeftDownIcon(collapseMatrixCardIcon.id),v.slideUp("fast"))):s.slideUp("fast"))}function GetSMS(n,t,i,r,u,f,e,o){var p=$("#divErrorSMS"),h,c,l,w,y;p.hide();h=$("#divErrorHardToken");h.hide();c=$("#divErrorPositions");c.hide();l=$("#divErrorPassword");l.hide();var s=$("#"+f),a=$("#"+e),v=$("#"+o),b=$("#"+u);matrixWasSuccess=!1;smsWasSuccess===!1?(w=$("#"+n),authentFormSMS.hide(),y=$("[id$=hdnGetPositions]"),y.val(2),eBankit.Presentation.BlockPageForAjaxRequest(),$("[id$=btnSendSMS]").click()):($(".trs_buttons-action").show(),ToogleArrowLeftDownIcon(collapseSmsTokenIcon.id),s.is(":hidden")?(s.slideDown("fast"),a.is(":visible")&&(ToogleArrowLeftDownIcon(collapseMatrixCardIcon.id),a.slideUp("fast")),v.is(":visible")&&(ToogleArrowLeftDownIcon(collapseHardTokenIcon.id),v.slideUp("fast"))):s.slideUp("fast"))}function GetPositionsMatrix(n,t,i,r,u,f){var p=$("#divErrorSMS"),c,h,l,a,v,y;p.hide();c=$("#divErrorHardToken");c.hide();h=$("#divErrorPositions");h.hide();l=$("#divErrorPassword");l.hide();smsWasSuccess=!1;tokenWasSuccess=!1;var b=$("#"+n),e=$("#"+r),o=$("#"+u),s=$("#"+f),k=$("#"+i),w=$("[id$=hdnShowSMSPanel]");w.val("0");a=$("[id$=hdnShowHardTokenPanel]");a.val("0");matrixWasSuccess===!1?(authentFormMatrix.hide(),v=$("[id$=hdnGetPositions]"),v.val(1),eBankit.Presentation.BlockPageForAjaxRequest(),url="services.axd?Method=GetPositions",y="&g="+t+"&InteractionId="+i,$.ajax({type:"POST",url:url+y,contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:function(n){n.setRequestHeader("Accept","text/javascript, application/javascript, */*, text/javascript,application/javascript,text/html");n.setRequestHeader("Content-type","application/json; charset=utf-8")},success:function(n){var t,u;for(matrixWasSuccess=!0,t=n,lblPositionMatrix_1.text(t[0].split(".")[0]+", "+t[0].split(".")[1]+top.eBankit.Presentation.GetResource("Position")),lblPositionMatrix_2.text(t[1].split(".")[0]+", "+t[1].split(".")[1]+top.eBankit.Presentation.GetResource("Position")),lblPositionMatrix_3.text(t[2].split(".")[0]+", "+t[2].split(".")[1]+top.eBankit.Presentation.GetResource("Position")),position1=t[0].split(".")[0],position2=t[1].split(".")[0],position3=t[2].split(".")[0],lblPositionMatrix_1.focus(),u=0;u<t.length;u++){var i="---",f="---",r=parseInt(t[u].split(".")[1]);if(r>0&&r<4){switch(r){case 1:i="? - -";break;case 2:i="- ? -";break;case 3:i="- - ?"}if(f=eval("$('#p"+t[u].split(".")[0]+" span').text();"),f!=="")switch(f){case"? - -":r===2?i="? ? -":r===3&&(i="? - ?");break;case"- ? -":r===1?i="? ? -":r===3&&(i="- ? ?");break;case"- - ?":r===1?i="? - ?":r===2&&(i="- ? ?")}eval("$('#p"+t[u].split(".")[0]+" span').text('"+i+"');");eval("$('#p"+t[u].split(".")[0]+" span').addClass('pos-sel');")}}ToogleArrowLeftDownIcon(collapseMatrixCardIcon.id);e.is(":hidden")?(e.slideDown("fast"),o.is(":visible")&&(ToogleArrowLeftDownIcon(collapseSmsTokenIcon.id),o.slideUp("fast")),s.is(":visible")&&(ToogleArrowLeftDownIcon(collapseSmsTokenIcon.id),s.slideUp("fast"))):e.slideUp("fast");$(".trs_buttons").show();$(".trs_buttons-action").show();authentFormMatrix.show();$("[id$=tabcontentinfo]").hide();$.unblockUI()},error:function(){o.is(":visible")&&(ToogleArrowLeftDownIcon(collapseSmsTokenIcon.id),o.slideUp("fast"));s.is(":visible")&&s.slideUp("fast");h.show();$(".trs_buttons").show();$(".trs_buttons-action").hide();$.unblockUI()}})):($(".trs_buttons-action").show(),ToogleArrowLeftDownIcon(collapseMatrixCardIcon.id),e.is(":hidden")?(e.slideDown("fast"),o.is(":visible")&&(ToogleArrowLeftDownIcon(collapseSmsTokenIcon.id),o.slideUp("fast")),s.is(":visible")&&(ToogleArrowLeftDownIcon(collapseHardTokenIcon.id),s.slideUp("fast"))):e.slideUp("fast"))}function ToogleArrowLeftDownIcon(n){var t=$("[id$="+n+"]");t.hasClass("icon-right-arrow")?(t.removeClass("icon-right-arrow"),t.addClass("icon-down-arrow")):(t.removeClass("icon-down-arrow"),t.addClass("icon-right-arrow"))}eBankit.Presentation.CredentialAuthorization={};eBankit.Presentation.CredentialAuthorization.EndRequest=function(){var r,u;$(".resend-msg").on("click",function(){smsWasSuccess=!1;tokenWasSuccess=!1;matrixWasSuccess=!1;smsRetry=!0;GetSMSClick(divSmsToken,SessionGUID,InteractionId,null,transactionId,collapseSmsToken,collapseMatrixCard,collapseHardToken)});if($(".resend-msg").keyup(function(n){n.keyCode===13&&($(this).click(),n.preventDefault())}),$(".resend-msg").attr("aria-label",$(".resend-msg").parent()[0].innerText),$(".resend-msg").attr("tabindex","0"),$("input:password").keydown(function(n){n.which===13&&($("[id$=btnNextFlowItem]")[0].click(),n.preventDefault())}),r=$("[id$=hdnShowSMSPanel]"),u=$("[id$=hdnShowHardTokenPanel]"),r.val()==="1"){smsWasSuccess=!0;var n=$("#"+collapseSmsToken),t=$("#"+collapseMatrixCard),i=$("#"+collapseHardToken),f=$("#"+transactionId);ToogleArrowLeftDownIcon(collapseSmsTokenIcon.id);n.is(":hidden")&&(n.slideDown("fast"),t.is(":visible")&&(ToogleArrowLeftDownIcon(collapseHardTokenIcon.id),t.slideUp("fast")),i.is(":visible")&&i.slideUp("fast"));$(".trs_buttons").show();$(".trs_buttons-action").show();authentFormSMS.show();$("[id$=tabcontentinfo]").hide();$.unblockUI()}else if(u.val()==="1"){tokenWasSuccess=!0;var n=$("#"+collapseHardToken),t=$("#"+collapseMatrixCard),i=$("#"+collapseSmsToken),f=$("#"+transactionId);ToogleArrowLeftDownIcon(collapseHardTokenIcon.id);n.is(":hidden")&&(n.slideDown("fast"),t.is(":visible")&&(ToogleArrowLeftDownIcon(collapseSmsTokenIcon.id),t.slideUp("fast")),i.is(":visible")&&i.slideUp("fast"));$(".trs_buttons").show();$(".trs_buttons-action").show();authentFormHardToken.show();$("[id$=tabcontentinfo]").hide();$.unblockUI()}};Sys.WebForms.PageRequestManager.getInstance().add_endRequest(eBankit.Presentation.CredentialAuthorization.EndRequest);$(document).ready(function(){if(eBankit.Presentation.CredentialAuthorization.EndRequest(),contractId!=null){var n="javascript: eBankit.document.location.href = '/Controls/Contract/ContractDetails.aspx?contract="+contractId+"'";$("[id*=btnBackFlowItem]").attr("onclick",n);$("[id*=btnBackFlowItem]").attr("href",null)}});var smsWasSuccess=!1,tokenWasSuccess=!1,matrixWasSuccess=!1,smsRetry=!1,position1,position2,position3;