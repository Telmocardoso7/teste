function getElementsByClassName(n,t,i){for(var u=n.getElementsByTagName(t),s=[],e,o,f,r=0;r<u.length;r++)if(e=u[r].className,e)for(o=e.split(" "),f=0;f<o.length;f++)if(o[f]==i){s.push(u[r]);break}return u=null,s}function keyboardDragDropEvent(n){var r=hdnGroupNamesIDs.val(),i=getElementsByClassName(document,"div","ui-draggable"),t;for(hdnCurrentAccSelected.val($(n).find(".accountNumber").text()),t=0;t<i.length;t++)i[t].style.top="0px",i[t].style.left="0px",i[t].tabIndex=0,i[t].setAttribute("aria-grabbed","false"),i[t].setAttribute("aria-haspopup","true"),i[t].onfocus=function(){this.className+=" focused"},i[t].onblur=function(){this.className=this.className.replace(/\s*focused/,"")},i[t].onmouseover=function(){this.className.indexOf("hover")<0&&(this.className+=" hover")},i[t].onmouseout=function(){this.className=this.className.replace(/\s*hover/,"")},drag.initialise(i[t])}eBankit.Presentation.TRX01802={};var drag={objCurrent:null,arTargets:[],initialise:function(n){n.onkeydown=drag.keyboardDragDrop;document.body.onclick=drag.removePopup},keyboardDragDrop:function(n){var e,t;n=n||window.event;drag.objCurrent=this;var c=$(this).find(".accountNumber").text(),o=hdnGroupNamesIDs.val(),s=[];o.length>0&&(s=jQuery.parseJSON(o));e=drag.verifyAccountInGroups(c.trim());t=[];$.each(s,function(n,i){i.isOwner&&(e.length>0?e.includes(i.idGroup.toString())||t.push(i.groupName+"#"+i.idGroup):t.push(i.groupName+"#"+i.idGroup))});var h=n.keyCode,f=drag.objCurrent,l=f.parentNode.getAttribute("id"),i,r,u;if(f.removeAttribute("style"),h==32||h==13){if(n.preventDefault(),f.setAttribute("style","background-color: rgba(239, 123, 48, 0.2);border: 3px solid rgba(239, 123, 48, 1)"),document.onkeydown=function(){return n.keyCode==38||n.keyCode==40?!1:!0},drag.objCurrent.setAttribute("aria-grabbed","true"),drag.objCurrent.setAttribute("aria-owns","popup"),objThead=document.createElement("thead"),objTableRowHeader=document.createElement("tr"),objTableHeader=document.createElement("th"),i=document.createElement("table"),objTBody=document.createElement("tBody"),i.setAttribute("id","popup"),i.setAttribute("role","menu"),objTableHeader.appendChild(document.createTextNode(top.eBankit.Presentation.GetResource("TRX01802MoveToGroup"))),objTableRowHeader.appendChild(objTableHeader),objThead.appendChild(objTableHeader),i.appendChild(objThead),t.length>0)for(u=0;u<t.length;u++)drag.arTargets[u]!=l&&(objElemTR=document.createElement("tr"),objInputHdn=document.createElement("input"),objInputHdn.setAttribute("type","hidden"),objInputHdn.setAttribute("value",t[u].split("#")[1]),r=document.createElement("td"),r.appendChild(document.createTextNode(t[u].split("#")[0])),objElemTR.appendChild(r),objElemTR.appendChild(objInputHdn),objElemTR.tabIndex=-1,objElemTR.setAttribute("role","menuitem"),objElemTR.onkeydown=drag.handleContext,objElemTR.onmouseover=function(){this.className.indexOf("hover")<0&&(this.className+=" hover")},objElemTR.onmouseout=function(){this.className=this.className.replace(/\s*hover/,"")},objTBody.appendChild(objElemTR));else objElemTR=document.createElement("tr"),r=document.createElement("td"),r.appendChild(document.createTextNode(top.eBankit.Presentation.GetResource("TRX01802MoveToGroupEmpty"))),objElemTR.appendChild(r),objElemTR.tabIndex=-1,objElemTR.setAttribute("role","menuitem"),objElemTR.onkeydown=drag.handleContext,objElemTR.onmouseover=function(){this.className.indexOf("hover")<0&&(this.className+=" hover")},objElemTR.onmouseout=function(){this.className=this.className.replace(/\s*hover/,"")},objTBody.appendChild(objElemTR);i.appendChild(objTBody);f.appendChild(i);objTBody.firstChild.focus();objTBody.firstChild.className="focus";drag.identifyTargets(!0)}},removePopup:function(){document.onkeydown=null;var n=document.getElementById("popup");n&&(n.parentNode.removeChild(n),drag.objCurrent.removeAttribute("style"))},handleContext:function(n){n=n||window.event;var i=n.target||n.srcElement,f=n.keyCode,t,u,r;n.stopPropagation?n.stopPropagation():n.cancelBubble&&(n.cancelBubble=!0);n.preventDefault?n.preventDefault():n.returnValue&&(n.returnValue=!1);switch(f){case 40:t=i.nextSibling;t||(t=i);i.className="";t.focus();t.className="focus";break;case 38:t=i.previousSibling;t||(t=i);i.className="";t.focus();t.className="focus";break;case 13:strTargetGroupID=$(i).find("input").val();drag.dropObject(strTargetGroupID);break;case 27:case 9:for(drag.objCurrent.removeAttribute("aria-owns"),drag.objCurrent.removeChild(i.parentNode.parentNode),drag.objCurrent.focus(),drag.objCurrent.removeAttribute("style"),r=0;r<drag.arTargets.length;r++)u=$("#"+drag.arTargets[r]).parent(),drag.objCurrent.setAttribute("aria-grabbed","false"),u.removeAttribute("aria-dropeffect"),u.className=""}},start:function(n){return n=n||window.event,drag.removePopup(),drag.objCurrent=this,drag.objCurrent.lastX=n.clientX,drag.objCurrent.lastY=n.clientY,drag.objCurrent.style.zIndex="2",drag.objCurrent.setAttribute("aria-grabbed","true"),document.onmousemove=drag.drag,document.onmouseup=drag.end,drag.identifyTargets(!0),!1},drag:function(n){n=n||window.event;var t=n.clientY,i=n.clientX,f=parseInt(drag.objCurrent.style.top,10),e=parseInt(drag.objCurrent.style.left,10),r,u;return r=e+i-drag.objCurrent.lastX,u=f+t-drag.objCurrent.lastY,drag.objCurrent.style.left=r+"px",drag.objCurrent.style.top=u+"px",drag.objCurrent.lastX=i,drag.objCurrent.lastY=t,!1},calculatePosition:function(n,t){var i=0;if(n.offsetParent)do i+=n[t],n=n.offsetParent;while(n);return i},identifyTargets:function(n){for(var r=drag.objCurrent.parentNode.getAttribute("id"),t,i=0;i<drag.arTargets.length;i++)t=$("#"+drag.arTargets[i]).parent(),n&&drag.arTargets[i]!=r?(t.className="highlight",t.attr("aria-dropeffect","move")):(t.className="",t.removeAttribute("aria-dropeffect"))},getTarget:function(){for(var h=drag.objCurrent.getAttribute("id"),f=drag.calculatePosition(drag.objCurrent,"offsetLeft"),e=drag.calculatePosition(drag.objCurrent,"offsetTop"),i=40,t,r,o,u,s,n=0;n<drag.arTargets.length;n++)if(drag.arTargets[n]!=h&&(t=document.getElementById(drag.arTargets[n]),r=drag.calculatePosition(t,"offsetLeft")-i,o=r+t.offsetWidth+i,u=drag.calculatePosition(t,"offsetTop")-i,s=u+t.offsetHeight+i,f>r&&f<o&&e>u&&e<s))return drag.arTargets[n];return""},findGroup:function(n){objGroups=$("#dragGroups").find(".groupInfo");var t;return $(objGroups).each(function(){var i=$(this).siblings("input");n===$(i).val()&&(t=$(i).siblings(".dropAccounts"))}),t},dropObject:function(n){var t,u,r,i;drag.removePopup();strTargetIDgrp=drag.findGroup(n);strTarget=$(strTargetIDgrp).attr("id");window.strTarget!==undefined&&strTarget.length>0?(u=drag.objCurrent,t=drag.objCurrent.cloneNode(!0),$(t).removeAttr("onkeypress"),$(t).removeAttr("aria-haspopup"),$(t).removeAttr("role"),$(t).removeAttr("aria-owns"),$(t).removeClass("ui-draggable"),$(t).removeClass("accountDrop"),$(t).removeClass("hover"),$(t).addClass("groupAcc"),$(t).addClass("ui-droppable"),$(t).children().eq(0).removeClass("col-xs-9"),$(t).children().eq(0).addClass("col-xs-7"),$(t).children().eq(2).addClass("orderDivAccount"),t.removeAttribute("style"),t.className=t.className.replace(/\s*focused/,""),t.className=t.className.replace(/\s*hover/,""),t.onfocus=function(){this.className+=" focused"},t.onblur=function(){this.className=this.className.replace(/\s*focused/,"")},t.onmouseover=function(){this.className.indexOf("hover")<0&&(this.className+=" hover")},t.onmouseout=function(){this.className=this.className.replace(/\s*hover/,"")},r=document.getElementById(strTarget),r=$(r).children(".sort"),$(r).append(t),$(t).find(".icons").toggleClass("hidden").siblings(".accountOrder").children().val($(t).find(".accountDrop").length-1),$("[id$=infoDivUnsavedChangesMessage]").removeClass("hidden"),drag.deleteAndOrderAccountEvent(t),drag.objCurrent=t,i=$(strTargetIDgrp).siblings(".groupInfo"),$(i).focus(),$(i).siblings(".dropAccounts").css("display")=="none"&&($(i).siblings(".dropAccounts").slideDown(),$(i).children().eq(0).children().eq(0).toggleClass("hidden"),$(i).children().eq(0).children().eq(1).toggleClass("hidden")),drag.end):drag.objCurrent.focus();drag.objCurrent.style.left="0px";drag.objCurrent.style.top="0px";drag.objCurrent.style.zIndex="auto";drag.objCurrent.setAttribute("aria-grabbed","false");drag.objCurrent.removeAttribute("aria-owns");drag.identifyTargets(!1)},deleteAndOrderAccountEvent:function(n){$(n).find(".deleteAccount").on("click",function(){$(this).parents(".groupAcc").remove();$("[id$=infoDivUnsavedChangesMessage]").removeClass("hidden")});$(n).find(".deleteAccount").on("keypress",function(){event.keyCode=="13"?($(this).parents(".groupAcc").remove(),$("[id$=infoDivUnsavedChangesMessage]").removeClass("hidden")):event.keyCode=="32"&&event.preventDefault()});var t=$(n).find(".order");$(t).attr("arial-label",top.eBankit.Presentation.GetResource("TRX01802OrderButtonAltText"));$(t).attr("title",top.eBankit.Presentation.GetResource("TRX01802OrderButtonAltText"));$(t).attr("alt",top.eBankit.Presentation.GetResource("TRX01802OrderButtonAltText"));$(t).attr("tabindex","0");$(t).attr("onkeypress",keyboarAccountsSortable($(t).attr("id")));$(t).attr("onkeydown",keyboarAccountsSortable($(t).attr("id")));$(n).find(".order").on("onkeypress",function(){keyboarAccountsSortable($(t).attr("id"))})},end:function(){var n=drag.getTarget();drag.dropObject(n);document.onmousemove=null;document.onmouseup=null;drag.objCurrent=null},verifyAccountInGroups:function(n){var i=$("#dragGroups"),t=[],r=$(i).find(".dropAccounts");return $(r).each(function(){var i=$(this).find(".accountDetailsNumber");$(i).each(function(){var r=$(this).text().trim(),i;n===r&&(i=$(this).parent().parent().parent().parent().siblings("input").eq(0).val(),t.push(i))})}),t}};